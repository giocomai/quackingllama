<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Process text with Ollama, retrieve structured results, cache them locally in DuckDB • quackingllama</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Process text with Ollama, retrieve structured results, cache them locally in DuckDB">
<meta name="description" content="Process text with Ollama, store results in DuckDB.">
<meta property="og:description" content="Process text with Ollama, store results in DuckDB.">
<meta property="og:image" content="https://giocomai.github.io/quackingllama/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">quackingllama</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9016</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="quackingllama-">quackingllama <a class="anchor" aria-label="anchor" href="#quackingllama-"></a>
</h1>
</div>
<!-- badges: start -->

<p>The goal of <code>quackingllama</code> is to facilitate efficient interactions with LLMs; its current target use-case is text classification (e.g. categorise or tag contents, or extract information from text). Key features include:</p>
<ul>
<li>facilitate consistently formatted responses (through <a href="https://ollama.com/blog/structured-outputs" class="external-link">Ollama’s structured ouputs</a>)</li>
<li>facilitate local caching (by storing results in a local <code>DuckDB</code> database)</li>
<li>facilitate initiating text classification tasks (through examples and convenience functions)</li>
<li>facilitate keeping a record with details about how each response has been received</li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of <code>quackingllama</code> from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"giocomai/quackingllama"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="default-options-and-outputs">Default options and outputs<a class="anchor" aria-label="anchor" href="#default-options-and-outputs"></a>
</h2>
<p>In order to facilitate consistent results, by default <code>quackingllama</code> sets the temperature of the model to 0: this means that it will always return the same response when given the same prompt. When caching is enabled, responses can then consistently be retrieved from the local cache without querying again the LLMs.</p>
<p>All functions consistently return results in a data frame (a tibble).</p>
<p>Key functionalities will be demonstrated through a series of examples.</p>
<p>As the package is developed further, some of the less intuitive tasks (e.g. defining a schema) will be facilitated through dedicated convenience functions.</p>
</div>
<div class="section level2">
<h2 id="basic-examples">Basic examples<a class="anchor" aria-label="anchor" href="#basic-examples"></a>
</h2>
<div class="section level3">
<h3 id="text-generation">Text generation<a class="anchor" aria-label="anchor" href="#text-generation"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://giocomai.github.io/quackingllama/">"quackingllama"</a></span><span class="op">)</span></span></code></pre></div>
<p>Let’s generate a short piece of text. Results are returned in a data frame, with the <code>response</code> in the first column and all relevant metadata about the query stored along with it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pol_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span>prompt <span class="op">=</span> <span class="st">"Describe an imaginary political leader in less than 100 words."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pol_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [1 × 21] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ response            : chr "Meet Aurora \"Rory\" Thompson, the charismatic and progressive leader of the coastal nation of Azura. A former "| __truncated__</span></span>
<span><span class="co">#&gt;  $ prompt              : chr "Describe an imaginary political leader in less than 100 words."</span></span>
<span><span class="co">#&gt;  $ thinking            : chr NA</span></span>
<span><span class="co">#&gt;  $ created_at          : chr "2025-07-19T14:40:25.179215418Z"</span></span>
<span><span class="co">#&gt;  $ done                : logi TRUE</span></span>
<span><span class="co">#&gt;  $ done_reason         : chr "stop"</span></span>
<span><span class="co">#&gt;  $ total_duration      : num 1.04e+10</span></span>
<span><span class="co">#&gt;  $ load_duration       : num 7.43e+09</span></span>
<span><span class="co">#&gt;  $ prompt_eval_count   : num 43</span></span>
<span><span class="co">#&gt;  $ prompt_eval_duration: num 2.59e+08</span></span>
<span><span class="co">#&gt;  $ eval_count          : num 118</span></span>
<span><span class="co">#&gt;  $ eval_duration       : num 2.72e+09</span></span>
<span><span class="co">#&gt;  $ timeout             : num 300</span></span>
<span><span class="co">#&gt;  $ keep_alive          : chr "5m"</span></span>
<span><span class="co">#&gt;  $ think               : logi FALSE</span></span>
<span><span class="co">#&gt;  $ model               : chr "llama3.2"</span></span>
<span><span class="co">#&gt;  $ system              : chr "You are a helpful assistant."</span></span>
<span><span class="co">#&gt;  $ format              : chr ""</span></span>
<span><span class="co">#&gt;  $ seed                : num 0</span></span>
<span><span class="co">#&gt;  $ temperature         : num 0</span></span>
<span><span class="co">#&gt;  $ hash                : chr "1b383c4d98978dfd1805743b597fd361"</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"&gt;"</span>, <span class="va">pol_df</span><span class="op">$</span><span class="va">response</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>Meet Aurora “Rory” Thompson, the charismatic and progressive leader of the coastal nation of Azura. A former environmental activist turned politician, Rory is known for her unwavering commitment to sustainability and social justice. With a warm smile and infectious laugh, she has won over the hearts of her constituents with her inclusive policies and bold vision for a greener future. As President of Azura, Rory has made it her mission to protect the planet while promoting economic growth and equality for all citizens. Her leadership style is collaborative, empathetic, and unapologetically forward-thinking.</p>
</blockquote>
<p>If we are interested in variations of this text, we can easily create them:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># TODO accept multiple prompts by default</span></span>
<span></span>
<span><span class="va">pol3_df</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"progressive"</span>, <span class="st">"conservative"</span>, <span class="st">"centrist"</span><span class="op">)</span>,</span>
<span>  .f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span>prompt <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Describe an imaginary {x} politician in less than 100 words."</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pol3_df</span><span class="op">$</span><span class="va">response</span></span>
<span><span class="co">#&gt; [1] "Meet Maya Ramos, a charismatic and visionary leader who embodies the values of social justice and environmental sustainability. As a former community organizer and small business owner, Maya understands the needs of everyday people and is committed to creating economic opportunities that lift up marginalized communities. Her progressive platform prioritizes affordable healthcare, free public education, and a Green New Deal that invests in renewable energy and sustainable infrastructure. With her warm smile and infectious passion, Maya inspires a new generation of activists and voters to join the fight for a more just and equitable society."</span></span>
<span><span class="co">#&gt; [2] "Meet Reginald P. Bottomsworth, a stalwart conservative politician from rural America. A third-generation farmer and small business owner, Reggie is known for his down-to-earth values and no-nonsense approach to governance. He supports traditional industries like agriculture and manufacturing, and advocates for limited government intervention in personal and economic matters. With a folksy demeanor and a strong work ethic, Reggie has built a loyal following among conservative voters who appreciate his commitment to preserving American traditions and individual freedoms. His slogan? \"Common sense, not Washington wisdom.\""                   </span></span>
<span><span class="co">#&gt; [3] "Meet Alexandra \"Alex\" Thompson, a pragmatic and moderate politician. A former business owner turned public servant, Alex brings a unique blend of fiscal responsibility and social compassion to the table. She advocates for balanced budgets, tax reform, and investments in education and infrastructure. However, she also prioritizes affordable healthcare, environmental protection, and social justice. With a calm and collected demeanor, Alex is able to bridge partisan divides and find common ground with her constituents. Her centrist approach has earned her a reputation as a trusted mediator and problem-solver in the halls of power."</span></span></code></pre></div>
<p>These are, as it is the customary default behaviour of LLMs, free form texts. Depending on the task at hand, we may want to have text in a more structured format. To do so, we must provide the LLM with a <a href="https://json-schema.org/" class="external-link">schema</a> of how we want it to to return data.</p>
<p>Schema can be very simple, e.g., if we want our response to feature only a “name” and “description” field, and both should be character strings, we’d use the following schema:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># TODO convenience function to facilitate creation of common schemas</span></span>
<span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"object"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    `name` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"string"</span><span class="op">)</span>,</span>
<span>    `description` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"string"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"description"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pol_schema_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span></span>
<span>  prompt <span class="op">=</span> <span class="st">"Describe an imaginary political leader."</span>,</span>
<span>  format <span class="op">=</span> <span class="va">schema</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pol_schema_df</span><span class="op">$</span><span class="va">response</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">yyjsonr</span><span class="fu">::</span><span class="fu"><a href="https://coolbutuseless.github.io/package/yyjsonr/reference/read_json_str.html" class="external-link">read_json_str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "Aurora Wynter"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $description</span></span>
<span><span class="co">#&gt; [1] "Aurora Wynter is a charismatic and visionary leader who has captivated the hearts of her people with her unwavering commitment to justice, equality, and environmental sustainability. Born in the coastal city of Newhaven, Aurora grew up surrounded by the beauty and fragility of the ocean, which instilled in her a deep love for the natural world and a fierce determination to protect it."</span></span></code></pre></div>
<p>or slightly more complex, for example making clear that we expect a field to be numeric, and another one to pick between one of a set of options:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"object"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    `name` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"string"</span><span class="op">)</span>,</span>
<span>    `age` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"number"</span><span class="op">)</span>,</span>
<span>    `gender` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      type <span class="op">=</span> <span class="st">"string"</span>,</span>
<span>      enum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span>, <span class="st">"non-binary"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    `motto` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"string"</span><span class="op">)</span>,</span>
<span>    `description` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"string"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"name"</span>,</span>
<span>    <span class="st">"age"</span>,</span>
<span>    <span class="st">"gender"</span>,</span>
<span>    <span class="st">"motto"</span>,</span>
<span>    <span class="st">"description"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>And the returned is formatted as expected:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pol_schema_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span></span>
<span>  prompt <span class="op">=</span> <span class="st">"Describe an imaginary political leader."</span>,</span>
<span>  format <span class="op">=</span> <span class="va">schema</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pol_schema_df</span><span class="op">$</span><span class="va">response</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">yyjsonr</span><span class="fu">::</span><span class="fu"><a href="https://coolbutuseless.github.io/package/yyjsonr/reference/read_json_str.html" class="external-link">read_json_str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "Aurora Wynter"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $age</span></span>
<span><span class="co">#&gt; [1] 52</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $gender</span></span>
<span><span class="co">#&gt; [1] "female"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $motto</span></span>
<span><span class="co">#&gt; [1] "Unity in Diversity, Progress through Inclusion"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $description</span></span>
<span><span class="co">#&gt; [1] "Aurora Wynter is a charismatic and visionary leader who has captivated the hearts of her people. Born into a family of modest means, she rose to prominence as a grassroots activist, fighting for social justice and equality. Her unwavering commitment to these values has earned her the respect and admiration of her constituents."</span></span></code></pre></div>
<p>Having the response in a structured format allows for easily storing results in a data frame and processing them further.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pol3_schema_df</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"progressive"</span>, <span class="st">"conservative"</span>, <span class="st">"centrist"</span><span class="op">)</span>,</span>
<span>  .f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span></span>
<span>      prompt <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Describe an imaginary {x} politician."</span><span class="op">)</span>,</span>
<span>      format <span class="op">=</span> <span class="va">schema</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pol3_schema_responses_df</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="va">pol3_schema_df</span><span class="op">$</span><span class="va">response</span>,</span>
<span>  .f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">yyjsonr</span><span class="fu">::</span><span class="fu"><a href="https://coolbutuseless.github.io/package/yyjsonr/reference/read_json_str.html" class="external-link">read_json_str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pol3_schema_responses_df</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 5</span></span>
<span><span class="co">#&gt;   name                       age gender motto                        description</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                    &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;                        &lt;chr&gt;      </span></span>
<span><span class="co">#&gt; 1 Maya Ramos                  42 female Empowering a Just and Equit… Maya Ramos…</span></span>
<span><span class="co">#&gt; 2 Reginald P. Bottomsworth    55 male   Tradition, Progress, and Pr… A seasoned…</span></span>
<span><span class="co">#&gt; 3 Alexander Thompson          52 male   Pragmatic Progress           Alexander …</span></span></code></pre></div>
<p>This has obvious advantages for many data processing tasks, and, as will be seen, can effectively be used to enhance the consistency of text classification tasks. But first, let’s discuss caching and some of the options that determine output.</p>
</div>
<div class="section level3">
<h3 id="caching-and-options">Caching and options<a class="anchor" aria-label="anchor" href="#caching-and-options"></a>
</h3>
<p>So far, local caching has not been enabled: this means that even when the exacts same response is expected, this will still be requested to the LLM, which can be exceedingly time-consuming especially for repetitive tasks, or for data processing pipelines that may recurrently encounter the same data.</p>
<p>Caching is the obvious answer to this process, but when do we expect exactly the same response from the LLM, considering that LLMs do not necessarily return the same response even when given the same prompt?</p>
<p>Two parameters are particularly relevant for understanding this, <code>temperature</code> and <code>seed</code>.</p>
<p>What is “temperature”? <a href="https://github.com/ollama/ollama/blob/main/docs/modelfile.md#valid-parameters-and-values" class="external-link">Ollama’s documentation</a> concisely clarifies the effect of this parameter by suggesting that “Increasing the temperature will make the model answer more creatively.” LLMs often have the default temperature set to 0.7 or 0.8. In brief, when temperature is set to its maximum value of 1, the LLMs will provide more varied responses. When temperature is set to 0, the LLMs are at their more consistent: they always provide the same response to the same prompt.</p>
<p>What does it mean in practices? For example, that if I set the temperature to 0 and ask the same LLM to generate a haiku, I will always get the very same haiku, no matter how many times I run this command.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span>prompt <span class="op">=</span> <span class="st">"A reasonably funny haiku"</span>, temperature <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Tacos on my face\nSalsa drips from happy lips\nMidlife crisis born"</span></span>
<span><span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span>prompt <span class="op">=</span> <span class="st">"A reasonably funny haiku"</span>, temperature <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Tacos on my face\nSalsa drips from happy lips\nMidlife crisis born"</span></span>
<span><span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span>prompt <span class="op">=</span> <span class="st">"A reasonably funny haiku"</span>, temperature <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Tacos on my face\nSalsa drips from happy lips\nMidlife crisis born"</span></span></code></pre></div>
<p>If I set the temperature to 1, I get every time a different haiku (ok, not very different, really, but still different).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span>prompt <span class="op">=</span> <span class="st">"A reasonably funny haiku"</span>, temperature <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Pizza in the night\nMozzarella dreams so sweet\nTummy's happy song"</span></span>
<span><span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span>prompt <span class="op">=</span> <span class="st">"A reasonably funny haiku"</span>, temperature <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Socks disappear too\n Lost my sole mates in the wash\nLonely foot remains"</span></span>
<span><span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span>prompt <span class="op">=</span> <span class="st">"A reasonably funny haiku"</span>, temperature <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Pizza in my face\nMelty cheese and saucey shame\nTummy's guilty grin"</span></span></code></pre></div>
<p>But then, replicability of results is possible even when the temperature is set to a value higher than 0. We just need to set the same seed, and we’ll consistently get the same result.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span>prompt <span class="op">=</span> <span class="st">"A reasonably funny haiku"</span>, temperature <span class="op">=</span> <span class="fl">1</span>, seed <span class="op">=</span> <span class="fl">2025</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Pizza in my lap\nMelted cheese and happy sigh\nLife's simple delight"</span></span>
<span><span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span>prompt <span class="op">=</span> <span class="st">"A reasonably funny haiku"</span>, temperature <span class="op">=</span> <span class="fl">1</span>, seed <span class="op">=</span> <span class="fl">2025</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Pizza in my lap\nMelted cheese and happy sigh\nLife's simple delight"</span></span>
<span><span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span>prompt <span class="op">=</span> <span class="st">"A reasonably funny haiku"</span>, temperature <span class="op">=</span> <span class="fl">1</span>, seed <span class="op">=</span> <span class="fl">2025</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Pizza in my lap\nMelted cheese and happy sigh\nLife's simple delight"</span></span></code></pre></div>
<p>Two additional components determine if the response is exactly the same in different instances: <code>system</code> and <code>format</code>. The <code>system</code> parameter is passed along with the prompt to the LLM, and by default is set to the generic “You are a helpful assistant.”. This is a reasonable generic option, but there may be good reasons to be more specific depending on the task at hand.</p>
<p>For example, if we set as the system message “You are a 19th century romantic poet.”, the style of the response will change (somewhat) accordingly.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span></span>
<span>  prompt <span class="op">=</span> <span class="st">"A reasonably funny haiku"</span>,</span>
<span>  temperature <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  system <span class="op">=</span> <span class="st">"You are a 19th century romantic writer."</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Fop's ridiculous hat\nTops his lumpy, love-struck face\nSighs of wretched bliss"</span></span></code></pre></div>
<p>As discussed above, <code>format</code> is relevant only for instances when a structured output is requested to the LLM by providing a schema. For example, if we provided a different schema, the output would also have been different.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"object"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    `haiku` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"string"</span><span class="op">)</span>,</span>
<span>    `why_funny` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"string"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"haiku"</span>,</span>
<span>    <span class="st">"why_funny"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">haiku_str_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span></span>
<span>  prompt <span class="op">=</span> <span class="st">"Write a funny haiku, and explain why it is supposed to be funny."</span>,</span>
<span>  format <span class="op">=</span> <span class="va">schema</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">haiku_str_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">yyjsonr</span><span class="fu">::</span><span class="fu"><a href="https://coolbutuseless.github.io/package/yyjsonr/reference/read_json_str.html" class="external-link">read_json_str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $haiku</span></span>
<span><span class="co">#&gt; [1] "I fart in space"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $why_funny</span></span>
<span><span class="co">#&gt; [1] "This haiku is humorous because it takes the common experience of passing gas and applies it to an unexpected situation - being in outer space. The idea that someone could let out a fart while floating in zero gravity, causing their own spaceship to drift away, is absurd and comical. It's also a bit of a commentary on how even in the most unlikely situations, human bodily functions can still be a source of embarrassment."</span></span></code></pre></div>
<p>In brief, when should we expect to receive exactly the same response from the LLM, hence, making it possible to retrieve it from cache if already parsed? The following conditions must apply:</p>
<ul>
<li>same model</li>
<li>same <code>system</code> parameter</li>
<li>same <code>format</code>, i.e., same schema (if given).</li>
<li>same prompt</li>
<li>and
<ul>
<li>either the same seed and any value for <code>temperature</code> OR</li>
<li>any seed and <code>temperature</code> set to zero</li>
</ul>
</li>
</ul>
<p>If the above conditions are met, and caching is enabled, the response will be retrieved from the local cache, rather than from the LLM.</p>
<p>It’s easy to enable caching for the current session with <code><a href="reference/ql_enable_db.html">ql_enable_db()</a></code>. By default, the database is stored in the current working directory, but this can be changed with <code><a href="reference/ql_set_db_options.html">ql_set_db_options()</a></code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ql_enable_db.html">ql_enable_db</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/ql_set_db_options.html">ql_set_db_options</a></span><span class="op">(</span>db_folder <span class="op">=</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_expand.html" class="external-link">path_home_r</a></span><span class="op">(</span><span class="st">"R"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now even prompts that would take the LLM many seconds to process can be returned efficiently from cache:</p>
</div>
<div class="section level3">
<h3 id="text-classification">Text classification<a class="anchor" aria-label="anchor" href="#text-classification"></a>
</h3>
<p>First, let’s create some texts that we will then try to classify:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"object"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    `party name` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"string"</span><span class="op">)</span>,</span>
<span>    `political leaning` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      type <span class="op">=</span> <span class="st">"string"</span>,</span>
<span>      enum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"progressive"</span>, <span class="st">"conservative"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    `political statement` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"string"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"party name"</span>,</span>
<span>    <span class="st">"political leaning"</span>,</span>
<span>    <span class="st">"political statement"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">parties_df</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"progressive"</span>, <span class="st">"conservative"</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  .y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>  .f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span></span>
<span>      prompt <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Describe an imaginary {x} political party, inventing their party name and a characteristic political statement."</span><span class="op">)</span>,</span>
<span>      format <span class="op">=</span> <span class="va">schema</span>,</span>
<span>      temperature <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      seed <span class="op">=</span> <span class="va">y</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">parties_responses_df</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="va">parties_df</span><span class="op">$</span><span class="va">response</span>,</span>
<span>  .f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">yyjsonr</span><span class="fu">::</span><span class="fu"><a href="https://coolbutuseless.github.io/package/yyjsonr/reference/read_json_str.html" class="external-link">read_json_str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">parties_responses_df</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 3</span></span>
<span><span class="co">#&gt;    `party name`              `political leaning` `political statement`          </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                     &lt;chr&gt;               &lt;chr&gt;                          </span></span>
<span><span class="co">#&gt;  1 The Luminari Party        progressive         "Embracing a global citizenry …</span></span>
<span><span class="co">#&gt;  2 Virtus                    conservative        "austrian  economics in americ…</span></span>
<span><span class="co">#&gt;  3 The New Horizon Party     progressive         "The New Horizon Party advocat…</span></span>
<span><span class="co">#&gt;  4 Libertarian Progressives  conservative        "Balancing Tradition with Inno…</span></span>
<span><span class="co">#&gt;  5 Luminaria                 progressive         "At Luminaria, we believe that…</span></span>
<span><span class="co">#&gt;  6 Libertas Novi             conservative        "We believe that the United St…</span></span>
<span><span class="co">#&gt;  7 Eudaimonia                progressive         "We believe that the greatest …</span></span>
<span><span class="co">#&gt;  8 The Terra Vita Party      conservative        "Emphasizing the importance of…</span></span>
<span><span class="co">#&gt;  9 Eunoia Party              progressive         "The Eunoia Party is committed…</span></span>
<span><span class="co">#&gt; 10 The New Order Party (NOP) conservative        "Protecting Traditional Values…</span></span></code></pre></div>
<p>Then we ask a different model to categorise results (in this example, text generation with <code>llama3.2</code>, text categorisation with <code>mistral</code>). Trimming explanations in the following table for clarity.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">category_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"object"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    `political leaning` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      type <span class="op">=</span> <span class="st">"string"</span>,</span>
<span>      enum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"progressive"</span>, <span class="st">"conservative"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    `explanation` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"string"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"political leaning"</span>,</span>
<span>    <span class="st">"explanation"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">categories_df</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="va">parties_responses_df</span><span class="op">[[</span><span class="st">"political statement"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  .f <span class="op">=</span> \<span class="op">(</span><span class="va">current_statement</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span></span>
<span>      prompt <span class="op">=</span> <span class="va">current_statement</span>,</span>
<span>      system <span class="op">=</span> <span class="st">"You identify the political leaning of political parties based on their statements."</span>,</span>
<span>      format <span class="op">=</span> <span class="va">category_schema</span>,</span>
<span>      temperature <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      model <span class="op">=</span> <span class="st">"mistral"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">categories_responses_df</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="va">categories_df</span><span class="op">$</span><span class="va">response</span>,</span>
<span>  .f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">yyjsonr</span><span class="fu">::</span><span class="fu"><a href="https://coolbutuseless.github.io/package/yyjsonr/reference/read_json_str.html" class="external-link">read_json_str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">responses_combo_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span></span>
<span>  <span class="va">parties_responses_df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>`given political leaning` <span class="op">=</span> <span class="va">`political leaning`</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`political statement`</span>, <span class="va">`given political leaning`</span><span class="op">)</span>,</span>
<span>  <span class="va">categories_responses_df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>`identified political leaning` <span class="op">=</span> <span class="va">`political leaning`</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">responses_combo_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>explanation <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trunc.html" class="external-link">str_trunc</a></span><span class="op">(</span><span class="va">explanation</span>, width <span class="op">=</span> <span class="fl">256</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="25%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="left">political statement</th>
<th align="left">given political leaning</th>
<th align="left">identified political leaning</th>
<th align="left">explanation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Embracing a global citizenry through the universal basic income, sustainable development and intergenerational justice.</td>
<td align="left">progressive</td>
<td align="left">progressive</td>
<td align="left">This statement advocates for three key progressive policies: Universal Basic Income (UBI), Sustainable Development, and Intergenerational Justice. The Universal Basic Income is a policy where every citizen receives a set amount of money regularly, regar…</td>
</tr>
<tr class="even">
<td align="left">austrian economics in american governance</td>
<td align="left">conservative</td>
<td align="left">conservative</td>
<td align="left">Austrian Economics, which emphasizes the importance of individual action and market processes, has had an influence on American governance, particularly among conservative political circles. The Austrian School’s key principles, such as subjectivism (th…</td>
</tr>
<tr class="odd">
<td align="left">The New Horizon Party advocates for a future where technology is used to create a sustainable, equitable, and just society for all.</td>
<td align="left">progressive</td>
<td align="left">progressive</td>
<td align="left">The New Horizon Party appears to be a progressive political party that emphasizes the use of technology to achieve a sustainable, equitable, and just society. This suggests they are forward-thinking, prioritizing innovation and technological advancement…</td>
</tr>
<tr class="even">
<td align="left">Balancing Tradition with Innovation</td>
<td align="left">conservative</td>
<td align="left">progressive</td>
<td align="left">Balancing tradition with innovation means finding a harmonious blend of respecting and preserving the values, customs, and practices of the past while embracing new ideas, technologies, and methods that can improve and advance society. This approach req…</td>
</tr>
<tr class="odd">
<td align="left">At Luminaria, we believe that the collective well-being of our society is inextricably linked to the well-being of its most vulnerable members. We advocate for a world where every individual has access to quality healthcare, education, and economic opportunities, regardless of their background or circumstances.</td>
<td align="left">progressive</td>
<td align="left">progressive</td>
<td align="left">Luminaria’s mission statement emphasizes the importance of social justice and equality for all individuals, particularly those who are most vulnerable in society. They advocate for policies that ensure access to essential resources such as healthcare, e…</td>
</tr>
<tr class="even">
<td align="left">We believe that the United States is at its strongest when it maintains a strong sense of self-reliance, limited government intervention, and unwavering commitment to traditional values.</td>
<td align="left">conservative</td>
<td align="left">conservative</td>
<td align="left">The statement suggests a conservative political ideology that emphasizes individualism, minimal government interference, and adherence to traditional values. This perspective often advocates for self-reliance, which means relying on one’s own efforts ra…</td>
</tr>
<tr class="odd">
<td align="left">We believe that the greatest wealth of any nation is not measured by its GDP or GDP per capita, but rather by the well-being and flourishing of all its citizens.</td>
<td align="left">progressive</td>
<td align="left">progressive</td>
<td align="left">This statement reflects a progressive perspective on economic development, emphasizing that a nation’s true wealth lies not in material wealth or financial indicators like GDP, but rather in the well-being and flourishing of its citizens. This perspecti…</td>
</tr>
<tr class="even">
<td align="left">Emphasizing the importance of local autonomy, traditional values, and environmental stewardship.</td>
<td align="left">conservative</td>
<td align="left">progressive</td>
<td align="left">This individual or group prioritizes the empowerment of local communities, preservation of cultural traditions, and sustainable management of natural resources. They advocate for policies that allow regions to govern themselves while maintaining a stron…</td>
</tr>
<tr class="odd">
<td align="left">The Eunoia Party is committed to ‘Designing a Brighter Tomorrow for All’ by prioritizing human well-being, social justice, and ecological sustainability.</td>
<td align="left">progressive</td>
<td align="left">progressive</td>
<td align="left">The Eunoia Party appears to be a progressive political party, as it emphasizes human well-being, social justice, and ecological sustainability. These are key issues that progressive parties often prioritize, with the goal of creating a more equitable an…</td>
</tr>
<tr class="even">
<td align="left">Protecting Traditional Values, Preserving Freedom</td>
<td align="left">conservative</td>
<td align="left">conservative</td>
<td align="left">This phrase suggests a political stance that values traditional customs and beliefs while also emphasizing the importance of individual freedom. It implies a balance between preserving cultural heritage and upholding personal liberties, often associated…</td>
</tr>
</tbody>
</table>
<p>In this stereotyped case, the LLM categorises most statements as expected and provide a broadly meaningful explanation for the choice (if you try with shorter sentences, e.g., just a political motto, the correct response rate decreases substantially). Fundamentally:</p>
<ul>
<li>responses are returned in a predictable and user-defined format, consistently responding with user-defined categories</li>
<li>responses are cached locally:
<ul>
<li>re-running a categorisation task is efficient</li>
<li>the categorisation of a large set of texts can be interrupted at will, and already processed contents will not be categorised again.</li>
</ul>
</li>
</ul>
<p>Querying with different models can have a substantial impact on the quality of results.</p>
</div>
</div>
<div class="section level2">
<h2 id="pass-images-to-the-model">Pass images to the model<a class="anchor" aria-label="anchor" href="#pass-images-to-the-model"></a>
</h2>
<p>You can pass images and have multimodal models such as e.g. “llama3.2-vision” or (the considerably smaller) “llava-phi3” consider them in their response. Just pass the path of the relevant image to <code><a href="reference/ql_prompt.html">ql_prompt()</a></code>. For example, if we ask to describe the logo of this package, we get the following reponse:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://giocomai.github.io/quackingllama/">"quackingllama"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">img_path</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"quackingllama"</span><span class="op">)</span>,</span>
<span>  <span class="st">"help"</span>,</span>
<span>  <span class="st">"figures"</span>,</span>
<span>  <span class="st">"logo.png"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">resp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span></span>
<span>  prompt <span class="op">=</span> <span class="st">"what is this?"</span>,</span>
<span>  images <span class="op">=</span> <span class="va">img_path</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"llama3.2-vision"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"&gt;"</span>, <span class="va">resp_df</span><span class="op">$</span><span class="va">response</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>This appears to be a digital illustration of a bird’s head, possibly a duck or goose, with a bright pink hexagon border around it. The image is likely a graphic or icon used for decorative or illustrative purposes.</p>
</blockquote>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span></span>
<span>  prompt <span class="op">=</span> <span class="st">"what is this?"</span>,</span>
<span>  images <span class="op">=</span> <span class="va">img_path</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"llava-phi3"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"&gt;"</span>, <span class="va">resp_df</span><span class="op">$</span><span class="va">response</span><span class="op">)</span></span>
<span><span class="co">#&gt; &gt; The image features a close-up of an alpaca's face, which is set against a black background. The alpaca has a yellow and gray mask on its face, with the eyes closed in what appears to be sleep or rest. The mask covers the alpaca's mouth and nose, giving it a unique appearance. The image is framed by a pink border, adding a pop of color to the overall composition. The alpaca seems calm and at ease despite the unusual accessory.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="thinking-models">Thinking models<a class="anchor" aria-label="anchor" href="#thinking-models"></a>
</h2>
<p>In May 2025, Ollama started supporting “thinking” models (<a href="https://ollama.com/blog/thinking" class="external-link">more details in the post announcing the feature</a>). Pay attention to the fact that not all reasoning models available via Ollama actually support thinking mode; as of July 2025, only three models were effectively supported (<code>deepseek-r1</code>, <code>qwen3</code>, and <code>magistral</code>). An <a href="https://ollama.com/search?c=thinking" class="external-link">up-to-date list should be available on Ollama’s website</a>.</p>
<p>When thinking mode is enabled, the LLM goes through an iterative “thinking” process before providing its answer. The “thinking” process is expressed in plain English and can be seen along with the response. See the following example:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strawberry_t_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ql_prompt.html">ql_prompt</a></span><span class="op">(</span></span>
<span>  prompt <span class="op">=</span> <span class="st">"How many r are there in strawberry? Provide a concise answer."</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"deepseek-r1:1.5b"</span>,</span>
<span>  think <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/ql_generate.html">ql_generate</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Here’s the thinking:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"&gt;"</span>, <span class="va">strawberry_t_df</span><span class="op">$</span><span class="va">thinking</span> <span class="op">|&gt;</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html" class="external-link">fixed</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>, replacement <span class="op">=</span> <span class="st">"\n &gt; "</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<blockquote>
<p>Okay, so I need to figure out how many ’r’s are in the word “strawberry.” Hmm, let me start by writing down the word: S T R A W B E R R Y.</p>
<p>Wait, that doesn’t seem right. Let me check again. The spelling is S-T-R-A-W-B-E-R-R-Y. So I think I missed an ‘r’ somewhere. Let me go through each letter one by one to make sure I don’t miss any.</p>
<ol style="list-style-type: decimal">
<li>S – nope.</li>
<li>T – nope.</li>
<li>R – yes, that’s the first ‘r’.</li>
<li>A – nope.</li>
<li>W – nope.</li>
<li>B – nope.</li>
<li>E – nope.</li>
<li>R – second ‘r’.</li>
<li>R – third ‘r’.</li>
<li>Y – nope.</li>
</ol>
<p>Wait a minute, I think I might have missed an ‘R’ at the end of “berry.” Let me count again: S T R A W B E R R Y. So after B comes E, then R (that’s one), then another R (two), and finally Y. So that makes three ’r’s in total.</p>
<p>But wait, I’m not sure if the word is spelled correctly. Maybe it’s “strawberry” without an extra ‘R’ at the end? Let me check a dictionary or something to confirm. Oh, no, it does have two more ’R’s after E and before Y. So that makes three ’r’s in total.</p>
<p>I think I was overcomplicating it by thinking about the word “strawberry” as if it were spelled without those extra letters. But actually, it is spelled with two more ’R’s. So the answer should be three ’r’s.</p>
</blockquote>
<p>And here is the response:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"&gt;"</span>, <span class="va">strawberry_t_df</span><span class="op">$</span><span class="va">response</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>There are three ’r’s in the word “strawberry.”</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="about-context-windows-and-time-outs">About context windows and time-outs<a class="anchor" aria-label="anchor" href="#about-context-windows-and-time-outs"></a>
</h2>
<p><code>ollama</code> is great in enabling easy local deployment of local LLMs, but comes with some embedded defaults that may come with unintended consequences.</p>
<div class="section level3">
<h3 id="about-the-context-window">About the context window<a class="anchor" aria-label="anchor" href="#about-the-context-window"></a>
</h3>
<p>If you look at the model page of one of the models available from Ollama’s website, you may well notice that some of these come with very large context windows. For example, <a href="https://ollama.com/library/gemma3" class="external-link"><code>gemma3</code></a> boasts a “128K context window”, big enough to include book-length inputs. You may well expect that, by default, this context window is fully available to you. You would, however, be mistaken: no matter the model’s capabilities, Ollama truncates the input at 2048 tokens: as a user, you would notice it only if you looked at the <code>ollama serve</code> logs, or because you notice unsatisfying results, as truncation happens in a way that is mostly invisible to the client. This is a known issue with Ollama, and until this is approached more sensibly by Ollama, the user should take core of this limitation themselves (<code>quackingllama</code> will likely include a dedicated warning in future versions). The easiest workaround is to re-create a new model with a larger context window: it’s a matter of a few seconds, following the <a href="https://github.com/ollama/ollama/issues/8099#issuecomment-2543316682" class="external-link">instructions reported in the relevant issue on Ollama</a>.</p>
<p>Basically, from the command line you do something like this:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="sc">$</span> ollama run gemma3</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="sc">&gt;</span><span class="er">&gt;&gt;</span> <span class="er">/</span>set parameter num_ctx <span class="dv">65536</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>Set parameter <span class="st">'num_ctx'</span> to <span class="st">'65536'</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="sc">&gt;</span><span class="er">&gt;&gt;</span> <span class="er">/</span>save gemma3<span class="dv">-64</span>k</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>Created new model <span class="st">'gemma3-64k'</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="sc">&gt;</span><span class="er">&gt;&gt;</span> <span class="er">/</span>bye</span></code></pre></div>
<p>And in a matter of seconds you will get a <code>gemma3</code> model with a 64k context window, which you’ll be able to use by choosing <code>gemma3-64k</code> as model.</p>
</div>
<div class="section level3">
<h3 id="about-timeout-and-keep_alive">About <code>timeout</code> and <code>keep_alive</code>
<a class="anchor" aria-label="anchor" href="#about-timeout-and-keep_alive"></a>
</h3>
<p>Congratulations, now you can enjoy bigger context windows. This is all nice, but this makes it also more likely that you are going to stumble into time-out issues, as processing lengthy prompts can take many minutes.</p>
<p>There are two parameters that determine how long <code>quackingllama</code> will wait for a response from <code>ollama</code> before throwing an error.</p>
<ul>
<li>one is <code>ollama</code>’s <code>keep_alive</code> argument, that basically tells how long the model should remain in memory after it is called. By default, this is “5m” for five minutes. If the model doesn’t get a response in time, it throws an error.</li>
<li>one is <code>httr2</code>’s <code>timeout</code> argument, that expresses how long the client should be waiting for a response. This defaults to “300”, as it is expressed in seconds, and corresponds to 5 minutes.</li>
</ul>
<p>The combined effect of these two arguments may not be exactly as you expect (a 5 minute <code>keep_alive</code> may actually let the model run for 10 minutes, if your <code>timeout</code> argument is big enough), but either way, be mindful and if you do expect lengthy response times, do set both values to an adequately high value.</p>
<p>On the other hand, if you know you have short prompts and expect quick responses, the defaults are more efficient, and will just move on sooner if the model is stuck for whatever reason.</p>
</div>
</div>
<div class="section level2">
<h2 id="about-the-hex-logo">About the hex logo<a class="anchor" aria-label="anchor" href="#about-the-hex-logo"></a>
</h2>
<p>In the logo you may or may not recognise a quacking llama, or maybe, just a llama wearing a duck mask. The reference is obviously to two of the main tools used by this package: <a href="https://ollama.com/" class="external-link"><code>ollama</code></a> and <a href="https://duckdb.org/docs/api/r.html" class="external-link"><code>DuckDB</code></a>. Image generated on my machine with <code>stablediffusion</code>.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing quackingllama</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Giorgio Comai <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0002-0515-9542" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Giorgio Comai.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
